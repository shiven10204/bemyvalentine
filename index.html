<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine Studio ğŸ€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Fredoka:wght@300;500;700&display=swap" rel="stylesheet">
    <style id="theme-styles">
        :root { 
            --bg: #fff5f7; 
            --card-bg: rgba(255, 255, 255, 0.95); 
            --border: #ffd1dc; 
            --shadow: #ffb7c5; 
            --primary: #ff4d6d; 
            --secondary: #ff85a1; 
        }
        
        body { 
            font-family: 'Fredoka', sans-serif; 
            background: var(--bg); 
            height: 100vh; 
            overflow: hidden; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: background 0.5s ease;
            touch-action: manipulation;
        }
        
        .cute-card { 
            background: var(--card-bg); 
            border: 8px solid var(--border); 
            border-radius: 40px; 
            box-shadow: 0 15px 0 var(--shadow); 
            transition: all 0.5s ease; 
        }

        .page { display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; height: 100%; width: 100%; padding: 20px; }
        .active { display: flex; animation: bounceIn 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        
        @keyframes bounceIn { 0% { transform: scale(0.3); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        
        /* Fixed No Button Logic */
        #no-button { 
            transition: all 0.2s ease; 
            z-index: 100;
        }
        
        select, input, textarea { 
            background: rgba(255, 255, 255, 0.6) !important; 
            border: 3px solid var(--border) !important; 
            border-radius: 15px !important; 
            padding: 10px !important; 
            color: var(--primary) !important; 
            font-weight: bold; 
            width: 100%; 
            outline: none; 
            margin-bottom: 8px;
            font-size: 16px; /* Prevents iOS zoom on input */
        }

        .bubble { position: absolute; background: white; border-radius: 50%; opacity: 0.6; pointer-events: none; animation: floatUp 10s infinite ease-in; z-index: 1; }
        @keyframes floatUp { 0% { transform: translateY(100vh) scale(0); opacity: 0; } 100% { transform: translateY(-10vh) scale(1.5); opacity: 0; } }
    </style>
</head>
<body>

    <div id="bubbles-container"></div>

    <div id="main-card" class="cute-card w-[92%] max-w-lg h-[600px] relative overflow-hidden flex flex-col items-center justify-center">
        
        <div id="page0" class="page">
            <h1 class="text-xl font-bold mb-3 text-[var(--primary)]">Valentine Studio ğŸ­</h1>
            <div class="w-full space-y-1 max-w-xs text-left overflow-y-auto pr-2" style="max-height: 380px;">
                <input type="text" id="my-name" placeholder="Your Name">
                <input type="text" id="crush-name" placeholder="Her Name">
                <textarea id="custom-msg" rows="2" placeholder="Write a cute note..."></textarea>
                <select id="theme-choice" onchange="applyTheme(this.value)">
                    <option value="cute">Pink Theme ğŸŒ¸</option>
                    <option value="dark">Dark Theme ğŸŒ™</option>
                    <option value="sky">Blue Theme â˜ï¸</option>
                </select>
                <select id="music-preset" onchange="previewMusic(this.value)">
                    <option value="none">No Music</option>
                    <option value="romantic">Love Story (Piano) ğŸ¹</option>
                    <option value="cute">Sweet Sunshine (Uke) ğŸ§¸</option>
                    <option value="chill">Midnight Snuggle (Lofi) â˜•</option>
                </select>
                <input type="text" id="img-url" placeholder="Photo Link (Optional)">
            </div>
            <button onclick="playSfx('pop'); generateLink()" class="mt-4 bg-[var(--primary)] text-white w-full max-w-xs py-3 rounded-2xl font-bold shadow-lg">Copy Magic Link ğŸ”—</button>
            <p id="link-status" class="mt-2 text-xs text-green-500 font-bold opacity-0 transition-opacity">Copied! âœ…</p>
        </div>

        <div id="page1" class="page">
            <div class="text-6xl mb-4 animate-bounce">ğŸ</div>
            <h1 class="text-2xl font-bold mb-2 text-[var(--primary)]">Hii <span class="val-her"></span>!</h1>
            <p class="text-[var(--secondary)] mb-8 text-lg italic">A surprise from <span class="val-me"></span>...</p>
            <button onclick="playSfx('pop'); startExperience()" class="px-10 py-4 bg-[var(--border)] text-[var(--primary)] rounded-full font-bold shadow-md">Open âœ¨</button>
        </div>

        <div id="page2" class="page">
            <div id="img-display" class="w-52 h-52 rounded-[30px] border-4 border-[var(--border)] overflow-hidden mb-6 shadow-inner flex items-center justify-center"></div>
            <h2 class="text-xl font-bold text-[var(--primary)] mb-4 italic">"Thinking of you..."</h2>
            <button onclick="playSfx('pop'); showPage('page3')" class="text-[var(--primary)] font-bold border-b-2 border-[var(--primary)]">Next â˜ï¸</button>
        </div>

        <div id="page3" class="page">
            <div class="text-5xl mb-4">ğŸ’Œ</div>
            <p id="display-msg" class="text-[var(--secondary)] leading-relaxed mb-8 px-4 text-lg italic">...</p>
            <button onclick="playSfx('pop'); showPage('page4')" class="bg-[var(--border)] text-[var(--primary)] px-8 py-3 rounded-full font-bold">One more thing... ğŸ­</button>
        </div>

        <div id="page4" class="page">
            <h1 id="question" class="text-2xl font-bold mb-12 text-[var(--primary)] px-2 leading-tight">Will you be my Valentine? ğŸ§¸</h1>
            
            <div id="button-area" class="relative w-full h-48 flex flex-col items-center justify-start gap-4">
                <button id="yes-button" onclick="playSfx('tada'); celebrate()" class="bg-[var(--primary)] text-white px-12 py-5 rounded-full text-2xl font-black shadow-xl order-1">YES! ğŸ’–</button>
                <button id="no-button" 
                        onmouseover="teleport()" 
                        onclick="teleport()" 
                        ontouchstart="teleport()"
                        class="bg-white text-[var(--secondary)] px-6 py-2 rounded-full text-sm border-2 border-[var(--border)] font-bold order-2 sm:relative">
                    No ğŸ¥º
                </button>
            </div>
        </div>

        <div id="page5" class="page">
            <div class="text-7xl mb-4">ğŸ“</div>
            <h1 class="text-4xl font-black mb-2 text-[var(--primary)]">YAYY!!</h1>
            <p class="text-lg text-[var(--secondary)] font-bold italic">It's a date! âœ¨</p>
        </div>
    </div>

    <audio id="music-player" loop></audio>

    <script>
        const themes = {
            cute: { bg: "#fff5f7", cardBg: "rgba(255, 255, 255, 0.95)", border: "#ffd1dc", shadow: "#ffb7c5", primary: "#ff4d6d", secondary: "#ff85a1" },
            dark: { bg: "#0f172a", cardBg: "rgba(30, 41, 59, 0.95)", border: "#334155", shadow: "#000000", primary: "#fbbf24", secondary: "#94a3b8" },
            sky: { bg: "#f0f9ff", cardBg: "rgba(255, 255, 255, 0.95)", border: "#bae6fd", shadow: "#7dd3fc", primary: "#0284c7", secondary: "#0ea5e9" }
        };

        const musicLibrary = {
            romantic: "https://www.chosic.com/wp-content/uploads/2021/04/Beautiful-Piano-Music.mp3",
            cute: "https://www.chosic.com/wp-content/uploads/2022/03/Sweet-Acoustic-Guitar.mp3",
            chill: "https://www.chosic.com/wp-content/uploads/2021/07/Lofi-Study.mp3"
        };

        const sfx = {
            pop: "https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3",
            whoosh: "https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3",
            tada: "https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"
        };

        function applyTheme(themeName) {
            const t = themes[themeName] || themes.cute;
            const root = document.documentElement;
            root.style.setProperty('--bg', t.bg);
            root.style.setProperty('--card-bg', t.cardBg);
            root.style.setProperty('--border', t.border);
            root.style.setProperty('--shadow', t.shadow);
            root.style.setProperty('--primary', t.primary);
            root.style.setProperty('--secondary', t.secondary);
        }

        function playSfx(type) {
            new Audio(sfx[type]).play().catch(() => {});
        }

        function previewMusic(type) {
            const player = document.getElementById('music-player');
            if (type === "none") { player.pause(); return; }
            player.src = musicLibrary[type];
            player.volume = 0.5;
            player.play().catch(() => {});
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            if (params.has('to')) {
                applyTheme(params.get('theme'));
                document.querySelectorAll('.val-her').forEach(e => e.innerText = params.get('to'));
                document.querySelectorAll('.val-me').forEach(e => e.innerText = params.get('from'));
                
                const msg = params.get('msg');
                document.getElementById('display-msg').innerText = (msg && msg !== "null") ? decodeURIComponent(msg) : "You make my world brighter! âœ¨";

                const imgUrl = params.get('img');
                const display = document.getElementById('img-display');
                if (imgUrl && imgUrl.trim() !== "" && imgUrl !== "null") {
                    display.innerHTML = `<img src="${decodeURIComponent(imgUrl)}" class="w-full h-full object-cover">`;
                } else {
                    display.innerHTML = `<div class="w-full h-full bg-[var(--bg)] flex items-center justify-center text-6xl">â¤ï¸</div>`;
                }
                showPage('page1');
            } else {
                showPage('page0');
            }
        };

        function generateLink() {
            const me = encodeURIComponent(document.getElementById('my-name').value || "Someone");
            const her = encodeURIComponent(document.getElementById('crush-name').value || "You");
            const msg = encodeURIComponent(document.getElementById('custom-msg').value);
            const img = encodeURIComponent(document.getElementById('img-url').value);
            const theme = document.getElementById('theme-choice').value;
            const music = document.getElementById('music-preset').value;
            
            const baseUrl = window.location.origin + window.location.pathname;
            const finalLink = `${baseUrl}?from=${me}&to=${her}&msg=${msg}&img=${img}&theme=${theme}&music=${music}`;
            
            navigator.clipboard.writeText(finalLink);
            document.getElementById('link-status').style.opacity = "1";
            setTimeout(() => document.getElementById('link-status').style.opacity = "0", 3000);
        }

        function startExperience() {
            showPage('page2');
            const params = new URLSearchParams(window.location.search);
            const musicType = params.get('music');
            if (musicType && musicType !== "none") {
                const player = document.getElementById('music-player');
                player.src = musicLibrary[musicType] || decodeURIComponent(musicType);
                player.play().catch(() => {});
            }
        }

        let scale = 1;
        function teleport() {
            playSfx('whoosh');
            const btn = document.getElementById('no-button');
            const area = document.getElementById('button-area');
            
            // Switch to absolute positioning only on first interaction
            btn.style.position = 'absolute';

            const maxX = area.clientWidth - btn.clientWidth;
            const maxY = area.clientHeight - btn.clientHeight;

            btn.style.left = Math.floor(Math.random() * maxX) + 'px';
            btn.style.top = Math.floor(Math.random() * maxY) + 'px';
            
            scale += 0.45;
            document.getElementById('yes-button').style.transform = `scale(${scale})`;
            if(scale > 4) btn.style.display = 'none';
        }

        function celebrate() {
            confetti({ particleCount: 200, spread: 80 });
            showPage('page5');
        }

        for(let i=0; i<10; i++) {
            let b = document.createElement('div'); b.className = 'bubble';
            b.style.width = Math.random() * 40 + 20 + 'px'; b.style.height = b.style.width;
            b.style.left = Math.random() * 100 + 'vw'; b.style.animationDelay = Math.random() * 5 + 's';
            document.getElementById('bubbles-container').appendChild(b);
        }
    </script>
</body>
</html>